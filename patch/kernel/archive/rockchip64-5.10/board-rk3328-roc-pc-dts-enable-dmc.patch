From e10f4b22df2ddd3408c7e71b12dc9290e31d020c Mon Sep 17 00:00:00 2001
From: Paolo Sabatino <paolo.sabatino@gmail.com>
Date: Tue, 12 Oct 2021 18:26:30 +0000
Subject: [PATCH] enable roc-pc dmc

---
 .../arm64/boot/dts/rockchip/rk3328-roc-pc.dts | 34 +++++++++++++++++++
 1 file changed, 34 insertions(+)

diff --git a/arch/arm64/boot/dts/rockchip/rk3328-roc-pc.dts b/arch/arm64/boot/dts/rockchip/rk3328-roc-pc.dts
index 56f1e1afe..348d717bc 100644
--- a/arch/arm64/boot/dts/rockchip/rk3328-roc-pc.dts
+++ b/arch/arm64/boot/dts/rockchip/rk3328-roc-pc.dts
@@ -4,6 +4,7 @@
  */
 
 /dts-v1/;
+#include "rk3328-roc-pc-dram-timing.dtsi"
 #include "rk3328.dtsi"
 
 / {
@@ -116,6 +117,29 @@ sdio_pwrseq: sdio-pwrseq {
 		pinctrl-0 = <&wifi_enable_h>;
 		reset-gpios = <&gpio3 RK_PB0 GPIO_ACTIVE_LOW>;
 	};
+
+	/delete-node/ dmc-opp-table;
+	dmc_opp_table: dmc-opp-table {
+		compatible = "operating-points-v2";
+
+		opp-786000000 {
+			opp-hz = /bits/ 64 <786000000>;
+			opp-microvolt = <1075000 1075000 1200000>;
+		};
+		opp-798000000 {
+			opp-hz = /bits/ 64 <798000000>;
+			opp-microvolt = <1075000 1075000 1200000>;
+		};
+		opp-840000000 {
+			opp-hz = /bits/ 64 <840000000>;
+			opp-microvolt = <1075000 1075000 1200000>;
+		};
+		opp-924000000 {
+			status = "disabled"; // unstable
+			opp-hz = /bits/ 64 <924000000>;
+			opp-microvolt = <1100000 1100000 1200000>;
+		};
+	};
 };
 
 &analog_sound {
@@ -357,6 +381,16 @@ usb_drv: usb20-host-drv {
 	};
 };
 
+&dfi {
+	status = "okay";
+};
+
+&dmc {
+	center-supply = <&vdd_logic>;
+	ddr_timing = <&ddr_timing>;
+	status = "okay";
+};
+
 &sdmmc_ext {
 	bus-width = <4>;
 	cap-sd-highspeed;
-- 
2.30.2

